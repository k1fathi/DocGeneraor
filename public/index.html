<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUZZUU Help Docs</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        header {
            background-color: #3498db;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .header-item {
            margin: 5px;
        }
        .search-container {
            display: flex;
            align-items: center;
        }
        #searchInput {
            padding: 0.5rem;
            border-radius: 4px;
            border: none;
            margin-right: 5px;
        }
        #searchButton {
            padding: 0.5rem;
            border-radius: 4px;
            border: none;
            background-color: white;
            color: #3498db;
            cursor: pointer;
        }
        .content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        .sidebar {
            width: 250px;
            background-color: #ffffff;
            overflow-y: auto;
            padding: 1rem;
            border-right: 1px solid #e0e0e0;
        }
        .main-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: #ffffff;
        }
        .file-item {
            cursor: pointer;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .file-item:hover {
            background-color: #e0e0e0;
        }
        .file-item.selected {
            background-color: #3498db;
            color: white;
        }
        .file-group {
            margin-left: 15px;
        }
        .file-group-header {
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .file-group-header::before {
            content: '▶';
            display: inline-block;
            margin-right: 5px;
            transition: transform 0.3s ease;
        }
        .file-group.expanded > .file-group-header::before {
            transform: rotate(90deg);
        }
        .file-group-content {
            display: none;
        }
        .file-group.expanded > .file-group-content {
            display: block;
        }
        #languageSelector {
            padding: 0.5rem;
            border-radius: 4px;
            border: none;
            background-color: white;
            color: #3498db;
        }
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            header {
                flex-direction: column;
                align-items: stretch;
            }
            .header-item {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="header-item">ZUZZUU Help Docs</h1>
            <div class="search-container header-item">
                <input type="text" id="searchInput" placeholder="Search...">
                <button id="searchButton">Search</button>
            </div>
            <select id="languageSelector" class="header-item">
                <option value="en">English</option>
                <option value="tr">Türkçe</option>
            </select>
        </header>
        <div class="content">
            <div class="sidebar" id="fileList">
                <!-- File list will be populated here -->
            </div>
            <div class="main-content" id="fileContent">
                <!-- Selected file content will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000';
        let currentLanguage = 'en';
        let allFiles = [];
        let selectedFile = null;

        function fetchFiles() {
            fetch(`${API_BASE_URL}/api/files`)
                .then(response => response.json())
                .then(files => {
                    allFiles = files;
                    displayFiles(files);
                })
                .catch(error => console.error('Error fetching files:', error));
        }

        function displayFiles(files) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            const fileTree = {};
            files.filter(file => file.name.endsWith(`_${currentLanguage}.html`))
                 .forEach(file => {
                    const parts = file.name.replace(`_${currentLanguage}.html`, '').split('_');
                    let currentLevel = fileTree;
                    parts.forEach((part, index) => {
                        if (!currentLevel[part]) {
                            currentLevel[part] = index === parts.length - 1 ? file : {};
                        }
                        currentLevel = currentLevel[part];
                    });
                 });

            function createFileTree(obj, parent) {
                for (const key in obj) {
                    if (typeof obj[key] === 'object' && !obj[key].name) {
                        const group = document.createElement('div');
                        group.className = 'file-group';
                        const header = document.createElement('div');
                        header.className = 'file-group-header';
                        header.textContent = key;
                        header.onclick = () => group.classList.toggle('expanded');
                        group.appendChild(header);
                        const content = document.createElement('div');
                        content.className = 'file-group-content';
                        group.appendChild(content);
                        parent.appendChild(group);
                        createFileTree(obj[key], content);
                    } else {
                        const file = obj[key];
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        fileItem.textContent = key;
                        fileItem.onclick = () => selectFile(file.name, fileItem);
                        if (file.name === selectedFile) {
                            fileItem.classList.add('selected');
                        }
                        parent.appendChild(fileItem);
                    }
                }
            }

            createFileTree(fileTree, fileList);
        }

        function selectFile(filename, fileItem) {
            const previouslySelected = document.querySelector('.file-item.selected');
            if (previouslySelected) {
                previouslySelected.classList.remove('selected');
            }
            fileItem.classList.add('selected');
            selectedFile = filename;
            loadFileContent(filename);
        }

        function loadFileContent(filename) {
            fetch(`${API_BASE_URL}/api/file/${filename}`)
                .then(response => response.json())
                .then(data => {
                    const contentDiv = document.getElementById('fileContent');
                    contentDiv.innerHTML = data.content;
                    highlightSearchTerm();
                })
                .catch(error => console.error('Error loading file content:', error));
        }

        function searchFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const matchingFiles = allFiles.filter(file => file.name.endsWith(`_${currentLanguage}.html`));
            let foundMatch = false;

            document.getElementById('fileList').innerHTML = '';

            matchingFiles.forEach(file => {
                fetch(`${API_BASE_URL}/api/file/${file.name}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.content.toLowerCase().includes(searchTerm)) {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            fileItem.textContent = file.name.replace(`_${currentLanguage}.html`, '').replace(/_/g, ' ');
                            fileItem.onclick = () => selectFile(file.name, fileItem);
                            document.getElementById('fileList').appendChild(fileItem);

                            if (!foundMatch) {
                                selectFile(file.name, fileItem);
                                foundMatch = true;
                            }
                        }
                    })
                    .catch(error => console.error('Error searching file:', error));
            });
        }

        function highlightSearchTerm() {
            const searchTerm = document.getElementById('searchInput').value;
            if (!searchTerm) return;

            const contentDiv = document.getElementById('fileContent');
            const regex = new RegExp(searchTerm, 'gi');
            contentDiv.innerHTML = contentDiv.innerHTML.replace(regex, match => `<span class="highlight">${match}</span>`);
        }

        document.getElementById('languageSelector').addEventListener('change', function() {
            currentLanguage = this.value;
            selectedFile = null;
            fetchFiles();
        });

        document.getElementById('searchButton').addEventListener('click', searchFiles);
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchFiles();
            }
        });

        window.onload = fetchFiles;
    </script>
</body>
</html>